@page "{subjectId:int}/{quizId:int}"
@model Quizpractice.Pages.Quizs.IndexModel

<!-- Hiển thị thông báo kết quả trả lời -->
@if (TempData["Result"] != null)
{
    <div class="alert alert-info">
        @TempData["Result"]
    </div>
}

<div class="review-progress-container">
    <div class="review-progress-header">
        <h2>Progress</h2>
        <span class="close-btn">X</span>
    </div>
    <div class="review-progress-content">
        <p>Time Remaining: <span id="timer" style="font-weight: bold; color: red;">20:00</span></p> <!-- Timer -->
        <p>Review before scoring exam..</p>
        <div class="progress-options">
            <div class="option unanswered">UNANSWERED</div>
            <div class="option marked">MARKED</div>
            <div class="option answered">ANSWERED</div>
            <div class="option all-questions">ALL QUESTIONS</div>
        </div>
        <div class="progress-numbers">
            @for (int i = 1; i <= Model.Questions.Count; i++)
            {
                var questionId = Model.Questions[i - 1].QuestionId;
                var answerStatus = HttpContext.Session.GetInt32($"Answer_{questionId}");

                <a href="@Url.Page("/Quizs/Detail", new { questionId = questionId, subjectId = Model.SubjectId })">
                    <div class="number @(answerStatus.HasValue ? "answered" : "unanswered")">
                        @i
                    </div>
                </a>
            }
        </div>
        <div class="score-exam-btn">
            <form id="scoreExamForm" method="post" asp-page-handler="ScoreExam">
                <button type="button" class="btn btn-primary" onclick="submitExam()">SCORE EXAM NOW</button>
            </form>
        </div>
    </div>
</div>

<script>
    // Countdown timer setup
    let timer = 20 * 60; // 20 minutes in seconds
    const timerElement = document.getElementById("timer");

    const countdown = setInterval(function () {
        const minutes = Math.floor(timer / 60);
        const seconds = timer % 60;

        // Update the timer display
        timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

        if (timer <= 0) {
            clearInterval(countdown);
            // Automatically submit the quiz when the time is up
            alert("Time is up! Your quiz will now be submitted.");
            document.getElementById("scoreExamForm").submit();
        }

        timer--;
    }, 1000);

    // This function will be triggered when the "SCORE EXAM NOW" button is clicked
    function submitExam() {
        // Log to the console to confirm the function is called
        console.log("submitExam function is being called");

        // Submit the form containing the "SCORE EXAM NOW" button
        document.getElementById("scoreExamForm").submit();
    }
</script>
